name: Dependency Review

on:
  pull_request:
    branches: [main, development]

jobs:
  dependency-review:
    name: Dependency Review
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Dependency Review
        uses: actions/dependency-review-action@v4
        with:
          fail-on-severity: moderate
          # Allow these licenses (common permissive licenses in JavaScript ecosystem)
          # Note: LGPL licenses included for sharp image processing library
          # Note: JSON license included for victory-vendor package
          # Note: CC0-1.0 included for vite and other build tools
          allow-licenses: MIT, MIT-0, Apache-2.0, BSD-2-Clause, BSD-3-Clause, ISC, MPL-2.0, CC-BY-4.0, CC0-1.0, 0BSD, MITNFA, LGPL-2.0-only, LGPL-2.1-only, LGPL-3.0-only, LGPL-3.0-or-later, JSON
          # Allow dependencies with undetected or compound licenses
          # Firebase SDK packages - from Google's official Firebase SDK (Apache-2.0)
          # Sharp libvips packages - image processing binaries with compound LGPL/MIT/BSD licenses
          allow-dependencies-licenses: 'pkg:npm/@firebase/ai, pkg:npm/@firebase/analytics, pkg:npm/@firebase/analytics-compat, pkg:npm/@firebase/app, pkg:npm/@firebase/app-check, pkg:npm/@firebase/app-check-compat, pkg:npm/@firebase/app-check-interop-types, pkg:npm/@firebase/app-compat, pkg:npm/@firebase/app-types, pkg:npm/@firebase/auth, pkg:npm/@firebase/auth-compat, pkg:npm/@firebase/auth-interop-types, pkg:npm/@firebase/component, pkg:npm/@firebase/data-connect, pkg:npm/@firebase/database, pkg:npm/@firebase/database-compat, pkg:npm/@firebase/database-types, pkg:npm/@firebase/firestore, pkg:npm/@firebase/firestore-compat, pkg:npm/@firebase/firestore-types, pkg:npm/@firebase/functions, pkg:npm/@firebase/functions-compat, pkg:npm/@firebase/functions-types, pkg:npm/@firebase/installations, pkg:npm/@firebase/installations-compat, pkg:npm/@firebase/installations-types, pkg:npm/@firebase/logger, pkg:npm/@firebase/messaging, pkg:npm/@firebase/messaging-compat, pkg:npm/@firebase/messaging-interop-types, pkg:npm/@firebase/performance, pkg:npm/@firebase/performance-compat, pkg:npm/@firebase/performance-types, pkg:npm/@firebase/remote-config, pkg:npm/@firebase/remote-config-compat, pkg:npm/@firebase/remote-config-types, pkg:npm/@firebase/storage, pkg:npm/@firebase/storage-compat, pkg:npm/@firebase/storage-types, pkg:npm/@firebase/util, pkg:npm/@firebase/vertexai, pkg:npm/@firebase/webchannel-wrapper, pkg:npm/@img/sharp-libvips-darwin-arm64, pkg:npm/@img/sharp-libvips-darwin-x64, pkg:npm/@img/sharp-libvips-linux-arm, pkg:npm/@img/sharp-libvips-linux-arm64, pkg:npm/@img/sharp-libvips-linux-ppc64, pkg:npm/@img/sharp-libvips-linux-riscv64, pkg:npm/@img/sharp-libvips-linux-s390x, pkg:npm/@img/sharp-libvips-linux-x64, pkg:npm/@img/sharp-libvips-linuxmusl-arm64, pkg:npm/@img/sharp-libvips-linuxmusl-x64, pkg:npm/@img/sharp-win32-arm64, pkg:npm/@img/sharp-win32-ia32, pkg:npm/@img/sharp-win32-x64'
          # Show OpenSSF scorecard but don't fail on low scores (warn at level 3)
          # firebase-admin transitive deps have scores below 3 but are from Google
          show-openssf-scorecard: true
          warn-on-openssf-scorecard-level: 3
