#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit validation..."

# 1. TypeScript Type Checking
echo "ğŸ“ Type checking..."
pnpm run typecheck
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript errors found. Fix them before committing."
  exit 1
fi

# 2. Linting
echo "ğŸ§¹ Linting..."
pnpm run lint
if [ $? -ne 0 ]; then
  echo "âŒ Linting errors found. Fix them before committing."
  exit 1
fi

# 3. Prisma Schema Validation
echo "ğŸ—„ï¸  Validating Prisma schema..."
pnpm prisma validate
if [ $? -ne 0 ]; then
  echo "âŒ Prisma schema validation failed."
  exit 1
fi

# 4. Unit Tests (fast feedback)
echo "ğŸ§ª Running unit tests..."
pnpm run test:unit --passWithNoTests --silent
if [ $? -ne 0 ]; then
  echo "âŒ Unit tests failed. Fix them before committing."
  exit 1
fi

# 5. Build Check (optional - uncomment if you want to test builds on every commit)
# Warning: This can slow down commits significantly
# echo "ğŸ—ï¸  Testing build..."
# pnpm run build:no-typecheck
# if [ $? -ne 0 ]; then
#   echo "âŒ Build failed. Fix errors before committing."
#   exit 1
# fi

echo "âœ… All pre-commit checks passed! Proceeding with commit..."
